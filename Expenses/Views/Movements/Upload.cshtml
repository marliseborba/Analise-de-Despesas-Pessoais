@using Newtonsoft.Json;
@model IEnumerable<Expenses.Models.Movement>

@{
    ViewData["Title"] = "Upload";
}

<br />
<br />
<h2>@ViewData["Title"]</h2>
<br />

@if(Model == null)
{
    <div>
        <form enctype="multipart/form-data" method="post" asp-action="Upload">
            <legend>Upload: </legend>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="border-primary text-light">
                <div class="col-md-6">
                    <label for="file" class="control-label"></label>
                    <input id="file" name="files" type="file" accept="csv" class="form-control" multiple />
                </div>
                <div>
                    <br />
                    <input type="submit" value="Upload" class="btn btn-secondary" />
                </div>
            </div>
        </form>
    </div>

}
else
{
    @if (@Model.Any())
    {
        //TempData["movs"] = @Model;
    }

    <br />
    <div class="row">
        <div class="col-md-3">
            Usuario: @Model.FirstOrDefault().Owner.Name
        </div>
        <div class="col-md-3">
            Items: @Model.Count()
        </div>
        <div class="col-md-3">
            Total: @Model.Sum(x => x.Value)
        </div>
        <div class="col-md-3" style="text-align:right">
            <a asp-action="SaveInvoice"> Salvar no Banco de Dados</a> 
        </div>
    </div>


<table class="table table-striped table-hover">

    <thead>
        <tr class="success">
            <th>
                Descrição
            </th>
            <th>
                Data
            </th>
            <th>
                Valor
            </th>
            <th>
                Identificador
            </th>
            <th>
                Estabelecimento
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Date)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Value)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Identifier)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Establishment.Name)
                </td>
            </tr>
        }
    </tbody>
</table>

}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#btnSave').on('click', function () {
            alert('onclick is working.');
            saves(); //Your function
        });
    });
    function saves() {
        alert('onclick is working.');
        $.ajax({
            type: "POST",
            url: @Url.Action("SaveInvoice"),
            data: JSON.stringify(Model.ToList()),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r) {
                alert(r + " record(s) inserted.");
            }
        });
    }
</script>